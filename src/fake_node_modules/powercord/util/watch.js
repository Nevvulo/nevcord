const EventEmitter = require('events');
const chokidar = require('chokidar');

class Watcher extends EventEmitter {
  constructor (filename, cb) {
    super();

    this.watcher = chokidar.watch(filename).on('change', (path) => {
      this._queue.push(path);
    });
    this.emptyInterval = setInterval(() => this.empty(cb), 500);
    this._queue = [];
  }

  empty (cb) {
    const items = this._queue.filter((item, index) => this._queue.indexOf(item) === index);

    if (items[0]) {
      for (const item of items) {
        cb(item);
      }

      this._queue = [];
    }
  }
}

module.exports = (filename, cb) => new Watcher(filename, cb);
